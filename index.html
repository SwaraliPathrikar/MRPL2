<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>MRPL - Integrated Security Command & Control Dashboard</title>
    <link rel="stylesheet" href="styles.css">
    <script src="https://cdn.jsdelivr.net/npm/chart.js"></script>
    <script src="https://cdnjs.cloudflare.com/ajax/libs/jspdf/2.5.1/jspdf.umd.min.js"></script>
    <script src="https://cdnjs.cloudflare.com/ajax/libs/jspdf-autotable/3.5.31/jspdf.plugin.autotable.min.js"></script>
</head>
<body>
    <header class="header">
        <div class="logo">
            <img src="MRPL_official_Logo.svg" alt="MRPL Logo" class="mrpl-logo" onerror="this.src='MRPL_official_Logo.png'">
            <div class="logo-text">
                <h1>MRPL- Manglore Refinery and Petrochemicals Limited</h1>
                <span class="subtitle">Integrated Security Command & Control System - Dashboard</span>
            </div>
        </div>
        <div class="header-info">
            <span id="currentTime"></span>
            <span class="user-info">Command Center | AxxonSoft VMS Integration</span>
        </div>
    </header>

    <nav class="nav-tabs">
        <button class="tab-btn active" onclick="showDashboard('availability')">AVAILABILITY</button>
        <button class="tab-btn" onclick="showDashboard('functional')">FUNCTIONAL</button>
        <button class="tab-btn" onclick="showDashboard('reports')">REPORTS</button>
    </nav>

    <!-- DASHBOARD 1: AVAILABILITY -->
    <div id="availability" class="dashboard-content active">
        
        <!-- Command & Control - Strategic Overview -->
        <!-- <div class="card" style="margin-bottom: 2rem;">
            <h3>Command & Control - Strategic Overview</h3>
            <div style="display: grid; grid-template-columns: repeat(2, 1fr); gap: 1.5rem; margin-top: 1rem;">
                
                <div onclick="showSecurityStatusDetails()" style="cursor: pointer; background: linear-gradient(135deg, rgba(0, 255, 136, 0.2) 0%, rgba(0, 255, 136, 0.05) 100%); border: 2px solid rgba(0, 255, 136, 0.3); border-radius: 12px; padding: 1.5rem; text-align: center; transition: all 0.3s; position: relative;">
                    <div style="font-size: 0.85rem; color: #8b9dc3; margin-bottom: 0.5rem;">Security Status</div>
                    <div style="font-size: 2.5rem; color: #00ff88; font-weight: bold; line-height: 1;">NORMAL</div>
                    <div style="font-size: 0.75rem; color: #8b9dc3; margin-top: 0.5rem;">All Systems Operational</div>
                    <div class="click-hint" style="position: absolute; bottom: 10px; right: 10px; font-size: 0.7rem; color: #00d4ff; opacity: 0; transition: opacity 0.3s;">Click for details</div>
                </div>
                
                
                <div onclick="showCCTVSystemHealth()" style="cursor: pointer; background: linear-gradient(135deg, rgba(0, 212, 255, 0.2) 0%, rgba(0, 212, 255, 0.05) 100%); border: 2px solid rgba(0, 212, 255, 0.3); border-radius: 12px; padding: 1.5rem; text-align: center; transition: all 0.3s; position: relative;">
                    <div style="font-size: 0.85rem; color: #8b9dc3; margin-bottom: 0.5rem;">CCTV Health</div>
                    <div style="font-size: 2.5rem; color: #00d4ff; font-weight: bold; line-height: 1;">96.8%</div>
                    <div style="font-size: 0.75rem; color: #8b9dc3; margin-top: 0.5rem;">245/253 Cameras Online</div>
                    <div class="click-hint" style="position: absolute; bottom: 10px; right: 10px; font-size: 0.7rem; color: #00d4ff; opacity: 0; transition: opacity 0.3s;">Click for details</div>
                </div>
            </div>
        </div> -->

        <!-- ALL DEVICES STATUS CARDS -->
        <div style="margin-top: 2rem; margin-bottom: 1rem; text-align: center;">
            <h2 style="color: #00d4ff; font-size: 1.5rem; margin-bottom: 0.5rem;">Complete Device Inventory Status</h2>
            <p style="color: #8b9dc3; font-size: 0.9rem;">Click any card to view detailed breakdown by gate and download reports</p>
        </div>
        
        <div id="allDevicesGrid" class="devices-grid" style="max-height: 220px; overflow: hidden; transition: max-height 0.5s ease;">
            <!-- Device cards will be dynamically generated here -->
        </div>
        
        <div style="text-align: center; margin: 1.5rem 0;">
            <button id="showMoreBtn" onclick="toggleShowMore()" style="background: linear-gradient(135deg, #667eea 0%, #764ba2 100%); color: white; border: none; padding: 0.5rem 1.5rem; border-radius: 6px; cursor: pointer; font-size: 0.85rem; font-weight: 500; transition: all 0.3s; box-shadow: 0 2px 8px rgba(102, 126, 234, 0.3);">
                Show More ▼
            </button>
        </div>

        <div class="grid-1">
            <div class="card">
                <div style="display: flex; justify-content: space-between; align-items: center; margin-bottom: 1rem;">
                    <h3>Gate-wise Device Health</h3>
                    <button onclick="downloadAllGatesReport()" style="background: linear-gradient(135deg, #667eea 0%, #764ba2 100%); color: white; border: none; padding: 0.6rem 1.2rem; border-radius: 8px; cursor: pointer; font-size: 0.9rem; font-weight: 500;">
                        All Gates Report
                    </button>
                </div>
                
                <p style="color: #8b9dc3; font-size: 0.9rem; margin-bottom: 1.5rem;">Click on any gate card to view detailed device list and distribution chart</p>
                
                <div id="gateCardsContainer" style="display: grid; grid-template-columns: repeat(auto-fit, minmax(280px, 1fr)); gap: 1rem;">
                    <!-- Will be populated by JavaScript -->
                </div>
            </div>
        </div>

        <div class="grid-2">
            <div class="card">
                <div style="display: flex; justify-content: space-between; align-items: center; margin-bottom: 1rem;">
                    <h3>Weekly Uptime Trend</h3>
                    <button onclick="showUptimeReportDateRange()" style="background: linear-gradient(135deg, #667eea 0%, #764ba2 100%); color: white; border: none; padding: 0.6rem 1rem; border-radius: 8px; cursor: pointer; font-size: 0.85rem; font-weight: 500;">
                        Download Report
                    </button>
                </div>
                <canvas id="uptimeTrendChart"></canvas>
            </div>
            <div class="card alert-panel">
                <h3>Live Alerts</h3>
                <div class="alert-list">
                    <div class="alert-item critical">
                        <span class="alert-time">14:23</span>
                        <span class="alert-msg">Camera not functional due to power issue - Cargo Gate Cam-05</span>
                    </div>
                    <div class="alert-item critical">
                        <span class="alert-time">13:45</span>
                        <span class="alert-msg">Primary SAN storage critically low - 120 TB free (95% of 2400 TB utilized). Video recording retention at risk. Immediate capacity action required.</span>
                    </div>
                    <div class="alert-item info">
                        <span class="alert-time">12:10</span>
                        <span class="alert-msg">Scheduled maintenance of ANPR at Jokatte Gate, Estimated completion time- 14:30</span>
                    </div>
                </div>
            </div>
        </div>
        
        <div class="card">
            <h3>Device Analytics & Distribution</h3>
            <div class="grid-3">
                <div style="background: rgba(0, 212, 255, 0.05); padding: 20px; border-radius: 8px;">
                    <canvas id="deviceCategoryChart"></canvas>
                </div>
                <!-- <div style="background: rgba(0, 212, 255, 0.05); padding: 20px; border-radius: 8px;">
                    <canvas id="topDevicesChart"></canvas>
                </div> -->
                <div style="background: rgba(0, 212, 255, 0.05); padding: 20px; border-radius: 8px;">
                    <canvas id="gateDeviceDistChart"></canvas>
                </div>
            </div>
        </div>
        
        <div class="card">
            <h3>Complete Device Inventory</h3>
            
            <div style="margin-bottom: 20px;">
                <input type="text" id="deviceSearch" placeholder="Search devices..." style="
                    width: 100%;
                    padding: 12px;
                    background: #0a0e27;
                    border: 2px solid #3d4a7a;
                    border-radius: 8px;
                    color: #e0e0e0;
                    font-size: 16px;
                " onkeyup="filterDevices()">
            </div>
            
            <div style="overflow-x: auto; max-height: 600px; overflow-y: auto;">
                <table class="data-table" id="fullInventoryTable">
                    <thead style="position: sticky; top: 0; background: #2d3561; z-index: 10;">
                        <tr>
                            <th style="min-width: 250px;">Device Type</th>
                            <th>Total</th>
                            <th style="min-width: 600px;">Gate-wise Distribution</th>
                        </tr>
                    </thead>
                    <tbody id="inventoryTableBody">
                        <tr>
                            <td colspan="3" style="text-align: center; padding: 40px;">
                                <div style="font-size: 18px; color: #8b9dc3;">
                                     Loading device inventory...
                                </div>
                            </td>
                        </tr>
                    </tbody>
                </table>
            </div>
            
            <div style="margin-top: 20px; padding: 15px; background: rgba(0, 212, 255, 0.1); border-radius: 8px; border-left: 4px solid #00d4ff;">
                <strong style="color: #00d4ff;">Summary:</strong>
                <span id="inventorySummary" style="color: #e0e0e0; margin-left: 10px;">Loading...</span>
            </div>
        </div>
    </div>

    <!-- DASHBOARD 2: FUNCTIONAL -->
    <div id="functional" class="dashboard-content">
        
        <!-- Real-time Security Operations KPIs -->
        <div class="kpi-grid">
            <div class="kpi-card highlight" onclick="showKPIDetails('vehicleEntries')" style="cursor: pointer; position: relative;">
                <div class="kpi-value live-counter" id="vehicleEntriesToday">1,250</div>
                <div class="kpi-label">Total Entries Today</div>
                <div class="kpi-sublabel">Vehicles (ANPR Tracked)</div>
                <div class="click-hint" style="position: absolute; bottom: 10px; right: 10px; font-size: 0.7rem; color: #00d4ff; opacity: 0; transition: opacity 0.3s;">Click for details</div>
            </div>
            <div class="kpi-card highlight">
                <div class="kpi-value live-counter" id="personnelInside">2,840</div>
                <div class="kpi-label">Total Entries Today</div>
                <div class="kpi-sublabel">Active Personnel Inside Refinery (FR Tracked)</div>
            </div>
            <div class="kpi-card status-good" onclick="showKPIDetails('accessGranted')" style="cursor: pointer; position: relative;">
                <div class="kpi-value" id="accessGranted">3,720</div>
                <div class="kpi-label">Access Granted Today</div>
                <div class="kpi-sublabel">All Gates Combined</div>
                <div class="click-hint" style="position: absolute; bottom: 10px; right: 10px; font-size: 0.7rem; color: #00d4ff; opacity: 0; transition: opacity 0.3s;">Click for details</div>
            </div>
            <div class="kpi-card status-warning" onclick="showKPIDetails('accessDenied')" style="cursor: pointer; position: relative;">
                <div class="kpi-value" id="accessDenied">28</div>
                <div class="kpi-label">Denied Access Attempts</div>
                <div class="kpi-sublabel">Unauthorized / Expired Badge</div>
                <div class="click-hint" style="position: absolute; bottom: 10px; right: 10px; font-size: 0.7rem; color: #00d4ff; opacity: 0; transition: opacity 0.3s;">Click for details</div>
            </div>
            <div class="kpi-card" onclick="showKPIDetails('specialEntries')" style="cursor: pointer; background: linear-gradient(135deg, rgba(255, 170, 0, 0.1) 0%, rgba(255, 170, 0, 0.05) 100%); border: 2px solid rgba(255, 170, 0, 0.3); position: relative;">
                <div class="kpi-value" id="specialEntries" style="color: #ffaa00;">18</div>
                <div class="kpi-label">Special Entries</div>
                <div class="kpi-sublabel">Without Pass / Emergency</div>
                <div class="click-hint" style="position: absolute; bottom: 10px; right: 10px; font-size: 0.7rem; color: #00d4ff; opacity: 0; transition: opacity 0.3s;">Click for details</div>
            </div>
            <div class="kpi-card" onclick="showGateProcessingDetails()" style="cursor: pointer; background: linear-gradient(135deg, rgba(0, 212, 255, 0.2) 0%, rgba(0, 212, 255, 0.05) 100%); border: 2px solid rgba(0, 212, 255, 0.3); position: relative;">
                <div class="kpi-value" id="avgProcessingTime" style="color: #00d4ff;">1 min</div>
                <div class="kpi-label">Avg Processing Time</div>
                <div class="kpi-sublabel">Gate Operations</div>
                <div class="click-hint" style="position: absolute; bottom: 10px; right: 10px; font-size: 0.7rem; color: #00d4ff; opacity: 0; transition: opacity 0.3s;">Click for details</div>
            </div>
        </div>
        
        <!-- Incident Management & Safety Violations -->
        <div class="card" style="margin-top: 2rem;">
            <div style="display: flex; justify-content: space-between; align-items: center; margin-bottom: 1rem;">
                <h3>Incident Management & Safety Violations</h3>
                <button onclick="showSLABreachReportOptions()" style="background: linear-gradient(135deg, #ff3366 0%, #ff6b9d 100%); color: white; border: none; padding: 0.6rem 1.2rem; border-radius: 8px; cursor: pointer; font-size: 0.9rem; font-weight: 500;">
                    Download SLA Breach Report
                </button>
            </div>
            
            <!-- Incident Tracking Row -->
            <div style="display: grid; grid-template-columns: repeat(3, 1fr); gap: 1.5rem; margin-bottom: 1.5rem;">
                <!-- Total Incidents Today -->
                <div onclick="showIncidentsByType('today')" style="cursor: pointer; background: linear-gradient(135deg, rgba(0, 212, 255, 0.2) 0%, rgba(0, 212, 255, 0.05) 100%); border: 2px solid rgba(0, 212, 255, 0.3); border-radius: 12px; padding: 1.5rem; text-align: center; transition: all 0.3s; position: relative;">
                    <div style="font-size: 0.85rem; color: #8b9dc3; margin-bottom: 0.5rem;">Incidents Today</div>
                    <div style="font-size: 3rem; color: #00d4ff; font-weight: bold; line-height: 1;">12</div>
                    <div style="font-size: 0.75rem; color: #8b9dc3; margin-top: 0.5rem;">8 Closed / 4 Open</div>
                    <div class="click-hint" style="position: absolute; bottom: 10px; right: 10px; font-size: 0.7rem; color: #00d4ff; opacity: 0; transition: opacity 0.3s;">Click for details</div>
                </div>
                
                <!-- Total Incidents This Week -->
                <div onclick="showIncidentsByType('week')" style="cursor: pointer; background: linear-gradient(135deg, rgba(0, 212, 255, 0.2) 0%, rgba(0, 212, 255, 0.05) 100%); border: 2px solid rgba(0, 212, 255, 0.3); border-radius: 12px; padding: 1.5rem; text-align: center; transition: all 0.3s; position: relative;">
                    <div style="font-size: 0.85rem; color: #8b9dc3; margin-bottom: 0.5rem;">Incidents This Week</div>
                    <div style="font-size: 3rem; color: #00d4ff; font-weight: bold; line-height: 1;">47</div>
                    <div style="font-size: 0.75rem; color: #8b9dc3; margin-top: 0.5rem;">38 Closed / 9 Open</div>
                    <div class="click-hint" style="position: absolute; bottom: 10px; right: 10px; font-size: 0.7rem; color: #00d4ff; opacity: 0; transition: opacity 0.3s;">Click for details</div>
                </div>
                
                <!-- Total Incidents This Month -->
                <div onclick="showIncidentsByType('month')" style="cursor: pointer; background: linear-gradient(135deg, rgba(0, 212, 255, 0.2) 0%, rgba(0, 212, 255, 0.05) 100%); border: 2px solid rgba(0, 212, 255, 0.3); border-radius: 12px; padding: 1.5rem; text-align: center; transition: all 0.3s; position: relative;">
                    <div style="font-size: 0.85rem; color: #8b9dc3; margin-bottom: 0.5rem;">Incidents This Month</div>
                    <div style="font-size: 3rem; color: #00d4ff; font-weight: bold; line-height: 1;">184</div>
                    <div style="font-size: 0.75rem; color: #8b9dc3; margin-top: 0.5rem;">165 Closed / 19 Open</div>
                    <div class="click-hint" style="position: absolute; bottom: 10px; right: 10px; font-size: 0.7rem; color: #00d4ff; opacity: 0; transition: opacity 0.3s;">Click for details</div>
                </div>
            </div>
            
            <!-- Incident Details & Safety Violations Row -->
            <div style="display: grid; grid-template-columns: repeat(4, 1fr); gap: 1.5rem; margin-top: 1rem;">
                <!-- Open Incidents -->
                <div onclick="showIncidentDetailsCard('open')" style="cursor: pointer; background: linear-gradient(135deg, rgba(255, 170, 0, 0.2) 0%, rgba(255, 170, 0, 0.05) 100%); border: 2px solid rgba(255, 170, 0, 0.3); border-radius: 12px; padding: 1.5rem; text-align: center; transition: all 0.3s; position: relative;">
                    <div style="font-size: 0.85rem; color: #8b9dc3; margin-bottom: 0.5rem;">Open Incidents</div>
                    <div style="font-size: 3rem; color: #ffaa00; font-weight: bold; line-height: 1;">4</div>
                    <!-- <div style="font-size: 0.75rem; color: #8b9dc3; margin-top: 0.5rem;">Avg: 25 min</div> -->
                    <div class="click-hint" style="position: absolute; bottom: 10px; right: 10px; font-size: 0.7rem; color: #00d4ff; opacity: 0; transition: opacity 0.3s;">Click for details</div>
                </div>
                
                <!-- Closed Incidents -->
                <div onclick="showIncidentDetailsCard('closed')" style="cursor: pointer; background: linear-gradient(135deg, rgba(0, 255, 136, 0.2) 0%, rgba(0, 255, 136, 0.05) 100%); border: 2px solid rgba(0, 255, 136, 0.3); border-radius: 12px; padding: 1.5rem; text-align: center; transition: all 0.3s; position: relative;">
                    <div style="font-size: 0.85rem; color: #8b9dc3; margin-bottom: 0.5rem;">Closed Today</div>
                    <div style="font-size: 3rem; color: #00ff88; font-weight: bold; line-height: 1;">8</div>
                    <div style="font-size: 0.75rem; color: #8b9dc3; margin-top: 0.5rem;">Avg: 18 min</div>
                    <div class="click-hint" style="position: absolute; bottom: 10px; right: 10px; font-size: 0.7rem; color: #00d4ff; opacity: 0; transition: opacity 0.3s;">Click for details</div>
                </div>
                
                <!-- SLA Compliance -->
                <div onclick="showSLABreachReportOptions()" style="cursor: pointer; background: linear-gradient(135deg, rgba(255, 51, 102, 0.2) 0%, rgba(255, 51, 102, 0.05) 100%); border: 2px solid rgba(255, 51, 102, 0.3); border-radius: 12px; padding: 1.5rem; text-align: center; transition: all 0.3s; position: relative;">
                    <div style="font-size: 0.85rem; color: #8b9dc3; margin-bottom: 0.5rem;">SLA Compliance</div>
                    <div style="font-size: 3rem; color: #00ff88; font-weight: bold; line-height: 1;">83%</div>
                    <div style="font-size: 0.75rem; color: #ff3366; margin-top: 0.5rem;">2 Breaches Today</div>
                    <div class="click-hint" style="position: absolute; bottom: 10px; right: 10px; font-size: 0.7rem; color: #00d4ff; opacity: 0; transition: opacity 0.3s;">Click for details</div>
                </div>
                
                <!-- Expired Badge Attempts -->
                <div onclick="showExpiredBadgeAttempts()" style="cursor: pointer !important; pointer-events: auto !important; background: linear-gradient(135deg, rgba(255, 51, 102, 0.2) 0%, rgba(255, 51, 102, 0.05) 100%); border: 2px solid rgba(255, 51, 102, 0.3); border-radius: 12px; padding: 1.5rem; text-align: center; transition: all 0.3s; position: relative;">
                    <div style="font-size: 0.85rem; color: #8b9dc3; margin-bottom: 0.5rem; pointer-events: none;">Expired Badge</div>
                    <div style="font-size: 3rem; color: #ff3366; font-weight: bold; line-height: 1; pointer-events: none;">6</div>
                    <div style="font-size: 0.75rem; color: #8b9dc3; margin-top: 0.5rem; pointer-events: none;">Access Attempts</div>
                    <div class="click-hint" style="position: absolute; bottom: 10px; right: 10px; font-size: 0.7rem; color: #00d4ff; opacity: 0; transition: opacity 0.3s; pointer-events: none;">Click for details</div>
                </div>
            </div>
            
            <!-- Vehicle & Speed Monitoring Row -->
            <div style="display: grid; grid-template-columns: repeat(4, 1fr); gap: 1.5rem; margin-top: 1.5rem;">
                <!-- Speed Violations - Plant Area -->
                <div onclick="showSpeedViolations('plant')" style="cursor: pointer !important; pointer-events: auto !important; background: linear-gradient(135deg, rgba(255, 51, 102, 0.2) 0%, rgba(255, 51, 102, 0.05) 100%); border: 2px solid rgba(255, 51, 102, 0.3); border-radius: 12px; padding: 1.5rem; text-align: center; transition: all 0.3s; position: relative;">
                    <div style="font-size: 0.85rem; color: #8b9dc3; margin-bottom: 0.5rem; pointer-events: none;">Speed Violation - Plant Area</div>
                    <div style="font-size: 3rem; color: #ff3366; font-weight: bold; line-height: 1; pointer-events: none;">12</div>
                    <div style="font-size: 0.75rem; color: #8b9dc3; margin-top: 0.5rem; pointer-events: none;">Today</div>
                    <div class="click-hint" style="position: absolute; bottom: 10px; right: 10px; font-size: 0.7rem; color: #00d4ff; opacity: 0; transition: opacity 0.3s; pointer-events: none;">Click for details</div>
                </div>
                
                <!-- Speed Violations - Non-Plant Area -->
                <div onclick="showSpeedViolations('nonplant')" style="cursor: pointer !important; pointer-events: auto !important; background: linear-gradient(135deg, rgba(255, 170, 0, 0.2) 0%, rgba(255, 170, 0, 0.05) 100%); border: 2px solid rgba(255, 170, 0, 0.3); border-radius: 12px; padding: 1.5rem; text-align: center; transition: all 0.3s; position: relative;">
                    <div style="font-size: 0.85rem; color: #8b9dc3; margin-bottom: 0.5rem; pointer-events: none;">Speed Violation- Non-Plant Area</div>
                    <div style="font-size: 3rem; color: #ffaa00; font-weight: bold; line-height: 1; pointer-events: none;">8</div>
                    <div style="font-size: 0.75rem; color: #8b9dc3; margin-top: 0.5rem; pointer-events: none;">Today</div>
                    <div class="click-hint" style="position: absolute; bottom: 10px; right: 10px; font-size: 0.7rem; color: #00d4ff; opacity: 0; transition: opacity 0.3s; pointer-events: none;">Click for details</div>
                </div>
                
                <!-- Tanker Movement -->
                <div onclick="showTankerMovement()" style="cursor: pointer !important; pointer-events: auto !important; background: linear-gradient(135deg, rgba(0, 212, 255, 0.2) 0%, rgba(0, 212, 255, 0.05) 100%); border: 2px solid rgba(0, 212, 255, 0.3); border-radius: 12px; padding: 1.5rem; text-align: center; transition: all 0.3s; position: relative;">
                    <div style="font-size: 0.85rem; color: #8b9dc3; margin-bottom: 0.5rem; pointer-events: none;">Tanker Movement</div>
                    <div style="font-size: 3rem; color: #00d4ff; font-weight: bold; line-height: 1; pointer-events: none;">45</div>
                    <div style="font-size: 0.75rem; color: #8b9dc3; margin-top: 0.5rem; pointer-events: none;">Today's Entries</div>
                    <div class="click-hint" style="position: absolute; bottom: 10px; right: 10px; font-size: 0.7rem; color: #00d4ff; opacity: 0; transition: opacity 0.3s; pointer-events: none;">Click for details</div>
                </div>
                
                <!-- Repeat Offenders -->
                <div onclick="showRepeatOffenders()" style="cursor: pointer !important; pointer-events: auto !important; background: linear-gradient(135deg, rgba(255, 51, 102, 0.2) 0%, rgba(255, 51, 102, 0.05) 100%); border: 2px solid rgba(255, 51, 102, 0.3); border-radius: 12px; padding: 1.5rem; text-align: center; transition: all 0.3s; position: relative;">
                    <div style="font-size: 0.85rem; color: #8b9dc3; margin-bottom: 0.5rem; pointer-events: none;">Repeat Offenders</div>
                    <div style="font-size: 3rem; color: #ff3366; font-weight: bold; line-height: 1; pointer-events: none;">5</div>
                    <div style="font-size: 0.75rem; color: #8b9dc3; margin-top: 0.5rem; pointer-events: none;">This Week</div>
                    <div class="click-hint" style="position: absolute; bottom: 10px; right: 10px; font-size: 0.7rem; color: #00d4ff; opacity: 0; transition: opacity 0.3s; pointer-events: none;">Click for details</div>
                </div>
            </div>
            
            <!-- Parking Management Row -->
            <div style="display: grid; grid-template-columns: repeat(4, 1fr); gap: 1.5rem; margin-top: 1.5rem;">
                <!-- Parked Vehicles Status -->
                <div onclick="showParkedVehicles()" style="cursor: pointer !important; pointer-events: auto !important; background: linear-gradient(135deg, rgba(0, 255, 136, 0.2) 0%, rgba(0, 255, 136, 0.05) 100%); border: 2px solid rgba(0, 255, 136, 0.3); border-radius: 12px; padding: 1.5rem; text-align: center; transition: all 0.3s; position: relative;">
                    <div style="font-size: 0.85rem; color: #8b9dc3; margin-bottom: 0.5rem; pointer-events: none;">Parked Vehicles</div>
                    <div style="font-size: 3rem; color: #00ff88; font-weight: bold; line-height: 1; pointer-events: none;">24</div>
                    <div style="font-size: 0.75rem; color: #8b9dc3; margin-top: 0.5rem; pointer-events: none;">Currently Parked</div>
                    <div class="click-hint" style="position: absolute; bottom: 10px; right: 10px; font-size: 0.7rem; color: #00d4ff; opacity: 0; transition: opacity 0.3s; pointer-events: none;">Click for details</div>
                </div>
            </div>
        </div>

        <!-- Incident Analytics Charts -->
        <div style="display: grid; grid-template-columns: 1fr 1fr; gap: 2rem; margin-top: 2rem;">
            <!-- 30-Day Incident Trend -->
            <div class="card">
                <div style="display: flex; justify-content: space-between; align-items: center; margin-bottom: 1rem;">
                    <h3>30-Day Incident Trend</h3>
                    <button onclick="showIncidentTrendReportOptions()" style="background: linear-gradient(135deg, #00d4ff 0%, #0099cc 100%); color: white; border: none; padding: 0.5rem 1rem; border-radius: 8px; cursor: pointer; font-size: 0.85rem; font-weight: 500;">
                        Download Report
                    </button>
                </div>
                <canvas id="incidentTrendChart" style="max-height: 300px;"></canvas>
            </div>
            
            <!-- Incident Severity Distribution -->
            <div class="card">
                <h3>Incident Severity Distribution</h3>
                <canvas id="severityChart" style="max-height: 300px;"></canvas>
            </div>
        </div>

        <!-- Gate-wise Live Operations -->
        <div class="card" style="margin-top: 2rem;">
            <h3>Live Gate Operations Status</h3>
            <div style="overflow-x: auto;">
                <table class="data-table">
                    <thead>
                        <tr>
                            <th>Gate Name</th>
                            <th>Status</th>
                            <th>Entries</th>
                            <th>Exits</th>
                            <th>Inside</th>
                        </tr>
                    </thead>
                    <tbody id="gateOperationsTable">
                        <tr>
                            <td style="font-weight: 600; color: #00d4ff;">Main Gate</td>
                            <td><span class="status-badge good">ACTIVE</span></td>
                            <td>1,245</td>
                            <td>1,180</td>
                            <td style="color: #00ff88; font-weight: bold;">65</td>
                        </tr>
                        <tr>
                            <td style="font-weight: 600; color: #00d4ff;">Cargo Gate</td>
                            <td><span class="status-badge good">ACTIVE</span></td>
                            <td>285</td>
                            <td>268</td>
                            <td style="color: #00ff88; font-weight: bold;">17</td>
                        </tr>
                        <tr>
                            <td style="font-weight: 600; color: #00d4ff;">LP Gate</td>
                            <td><span class="status-badge good">ACTIVE</span></td>
                            <td>856</td>
                            <td>842</td>
                            <td style="color: #00ff88; font-weight: bold;">14</td>
                        </tr>
                        <tr>
                            <td style="font-weight: 600; color: #00d4ff;">Jokatte Gate</td>
                            <td><span class="status-badge good">ACTIVE</span></td>
                            <td>642</td>
                            <td>628</td>
                            <td style="color: #00ff88; font-weight: bold;">14</td>
                        </tr>
                        <tr>
                            <td style="font-weight: 600; color: #00d4ff;">E2 Gate</td>
                            <td><span class="status-badge good">ACTIVE</span></td>
                            <td>428</td>
                            <td>415</td>
                            <td style="color: #00ff88; font-weight: bold;">13</td>
                        </tr>
                        <!-- <tr>
                            <td style="font-weight: 600; color: #00d4ff;">Railway Siding</td>
                            <td><span class="status-badge good">ACTIVE</span></td>
                            <td>45</td>
                            <td>42</td>
                            <td style="color: #00ff88; font-weight: bold;">3</td>
                        </tr>
                        <tr>
                            <td style="font-weight: 600; color: #00d4ff;">PCR</td>
                            <td><span class="status-badge good">ACTIVE</span></td>
                            <td>124</td>
                            <td>118</td>
                            <td style="color: #00ff88; font-weight: bold;">6</td>
                        </tr>
                        <tr>
                            <td style="font-weight: 600; color: #00d4ff;">CISF Checking</td>
                            <td><span class="status-badge good">ACTIVE</span></td>
                            <td>95</td>
                            <td>92</td>
                            <td style="color: #00ff88; font-weight: bold;">3</td>
                        </tr> -->
                    </tbody>
                </table>
            </div>
        </div>

        <!-- Analytics Charts -->
        <div class="grid-3" style="margin-top: 2rem;">
            <div class="card">
                <h3>Gender Analytics</h3>
                <canvas id="genderChart"></canvas>
            </div>
            <div class="card">
                <h3>Vehicle Type Distribution</h3>
                <canvas id="vehicleTypeChart"></canvas>
            </div>
            <!-- <div class="card">
                <h3>Hourly Entry Pattern</h3>
                <canvas id="hourlyEntryChart"></canvas>
            </div> -->
        </div>

        <!-- Security Screening Status -->
        <div class="card">
            <h3>Security Screening Status</h3>
            <div style="overflow-x: auto; margin-top: 1rem;">
                <table class="data-table">
                    <thead>
                        <tr>
                            <th style="text-align: left;">Screening Type</th>
                            <th style="text-align: center;">Completed Today</th>
                            <th style="text-align: center;">Alerts</th>
                            <th style="text-align: center;">Status</th>
                        </tr>
                    </thead>
                    <tbody>
                        <tr>
                            <td style="font-weight: 500;">Door Frame Metal Detector (DFMD)</td>
                            <td style="color: #00ff88; font-weight: bold; text-align: center; font-size: 1.1rem;">2,845</td>
                            <td style="color: #ffd700; font-weight: bold; text-align: center; font-size: 1.1rem;">3</td>
                            <td style="text-align: center;"><span class="status-badge good">ACTIVE</span></td>
                        </tr>
                        <tr>
                            <td style="font-weight: 500;">Baggage X-Ray Scan</td>
                            <td style="color: #00ff88; font-weight: bold; text-align: center; font-size: 1.1rem;">1,256</td>
                            <td style="color: #ffd700; font-weight: bold; text-align: center; font-size: 1.1rem;">2</td>
                            <td style="text-align: center;"><span class="status-badge good">ACTIVE</span></td>
                        </tr>
                        <tr>
                            <td style="font-weight: 500;">Under Vehicle Surveillance System (UVSS)</td>
                            <td style="color: #00ff88; font-weight: bold; text-align: center; font-size: 1.1rem;">285</td>
                            <td style="color: #ff3366; font-weight: bold; text-align: center; font-size: 1.1rem;">1</td>
                            <td style="text-align: center;"><span class="status-badge good">ACTIVE</span></td>
                        </tr>
                        <!-- <tr>
                            <td style="font-weight: 500;">Frisking Booth</td>
                            <td style="color: #00ff88; font-weight: bold; text-align: center; font-size: 1.1rem;">156</td>
                            <td style="color: #00ff88; font-weight: bold; text-align: center; font-size: 1.1rem;">0</td>
                            <td style="text-align: center;"><span class="status-badge good">ACTIVE</span></td>
                        </tr> -->
                    </tbody>
                </table>
            </div>
        </div>

        <!-- Access Control Performance -->
        <!-- <div class="card">
            <h3>Access Control Performance</h3>
            <div style="display: grid; grid-template-columns: repeat(4, 1fr); gap: 1rem; margin-top: 1rem;">
                <div style="background: rgba(0, 255, 136, 0.1); padding: 1rem; border-radius: 8px; text-align: center;">
                    <div style="font-size: 0.85rem; color: #8b9dc3; margin-bottom: 0.5rem;">Face Recognition</div>
                    <div style="font-size: 2rem; color: #00ff88; font-weight: bold;">98.7%</div>
                    <div style="font-size: 0.75rem; color: #8b9dc3; margin-top: 0.3rem;">3,456 / 3,502 attempts</div>
                </div>
                <div style="background: rgba(0, 212, 255, 0.1); padding: 1rem; border-radius: 8px; text-align: center;">
                    <div style="font-size: 0.85rem; color: #8b9dc3; margin-bottom: 0.5rem;">RFID Card</div>
                    <div style="font-size: 2rem; color: #00d4ff; font-weight: bold;">99.2%</div>
                    <div style="font-size: 0.75rem; color: #8b9dc3; margin-top: 0.3rem;">2,845 / 2,868 attempts</div>
                </div>
                <div style="background: rgba(255, 215, 0, 0.1); padding: 1rem; border-radius: 8px; text-align: center;">
                    <div style="font-size: 0.85rem; color: #8b9dc3; margin-bottom: 0.5rem;">ANPR Detection</div>
                    <div style="font-size: 2rem; color: #ffd700; font-weight: bold;">97.4%</div>
                    <div style="font-size: 0.75rem; color: #8b9dc3; margin-top: 0.3rem;">1,218 / 1,250 vehicles</div>
                </div>
                <div style="background: rgba(255, 51, 102, 0.1); padding: 1rem; border-radius: 8px; text-align: center;">
                    <div style="font-size: 0.85rem; color: #8b9dc3; margin-bottom: 0.5rem;">Unauthorized</div>
                    <div style="font-size: 2rem; color: #ff3366; font-weight: bold;">28</div>
                    <div style="font-size: 0.75rem; color: #8b9dc3; margin-top: 0.3rem;">Blocked & Logged</div>
                </div>
            </div>
        </div> -->
    </div>

    <!-- DASHBOARD 3: REPORTS -->
    <div id="reports" class="dashboard-content">
        <div class="card">
            <h3>MRPL Security Reports</h3>
            <div class="reports-grid">
                <div class="report-card" onclick="generateReport('daily')">
                    <!-- <div class="report-icon">📅</div> -->
                    <div class="report-title">Daily Security Report</div>
                    <div class="report-desc">Entry/Exit, Visitors, Violations, Gate-wise Summary</div>
                </div>
                <div class="report-card" onclick="generateReport('speed')">
                    <!-- <div class="report-icon">🚗</div> -->
                    <div class="report-title">Speed Violation Report</div>
                    <div class="report-desc">Vehicle No, Speed, Location, Snapshots, Time</div>
                </div>
                <div class="report-card" onclick="generateReport('blacklist')">
                    <!-- <div class="report-icon">🚫</div> -->
                    <div class="report-title">Blacklisted Vehicle Alert</div>
                    <div class="report-desc">Attempted entries, ANPR Alerts, Action Taken</div>
                </div>
                <div class="report-card" onclick="generateReport('contractor')">
                    <!-- <div class="report-icon">👷</div> -->
                    <div class="report-title">Contractor Attendance</div>
                    <div class="report-desc">In/Out time, Total hours, Overtime, Biometric</div>
                </div>
                <div class="report-card" onclick="generateReport('visitor')">
                    <!-- <div class="report-icon">👥</div> -->
                    <div class="report-title">Visitor Management</div>
                    <div class="report-desc">Visitor logs, Overstay cases, Gate-wise entry</div>
                </div>
                <div class="report-card" onclick="generateReport('access')">
                    <!-- <div class="report-icon">DENIED</div> -->
                    <div class="report-title">Access Denied Report</div>
                    <div class="report-desc">Unauthorized attempts, Face mismatch, Card issues</div>
                </div>
                <div class="report-card" onclick="generateReport('downtime')">
                    <!-- <div class="report-icon">⚙️</div> -->
                    <div class="report-title">System Downtime (CAMC)</div>
                    <div class="report-desc">Device failures, MTTR, Vendor response, SLA</div>
                </div>
                <div class="report-card" onclick="generateReport('gate')">
                    <!-- <div class="report-icon">🚪</div> -->
                    <div class="report-title">Gate Performance Report</div>
                    <div class="report-desc">Traffic analysis, Peak hours, Throughput</div>
                </div>
                <div class="report-card" onclick="generateReport('incident')">
                    <!-- <div class="report-icon">WARNING</div> -->
                    <div class="report-title">Incident & Alert Report</div>
                    <div class="report-desc">Security incidents, Response time, Resolution</div>
                </div>
                <div class="report-card" onclick="generateReport('ppe')">
                    <!-- <div class="report-icon">🦺</div> -->
                    <div class="report-title">PPE Compliance Report</div>
                    <div class="report-desc">Helmet detection, Safety gear violations</div>
                </div>
                <div class="report-card" onclick="generateReport('parking')">
                    <!-- <div class="report-icon">🅿️</div> -->
                    <div class="report-title">Parking Utilization</div>
                    <div class="report-desc">Occupancy, Duration, Zone-wise analysis</div>
                </div>
                <div class="report-card" onclick="generateReport('analytics')">
                    <!-- <div class="report-icon">📈</div> -->
                    <div class="report-title">Security Analytics</div>
                    <div class="report-desc">Trends, Patterns, Predictive insights, KPIs</div>
                </div>
            </div>
        </div>
        
        <div class="card" style="margin-top: 20px;">
            <h3>Report Scheduling & Export</h3>
            <div style="padding: 20px;">
                <p style="margin-bottom: 15px; color: #8b9dc3;">Configure automated report generation and distribution</p>
                <div style="display: grid; grid-template-columns: repeat(auto-fit, minmax(200px, 1fr)); gap: 15px;">
                    <button class="btn-action" style="width: 100%; padding: 15px;">Daily Auto-Reports</button>
                    <button class="btn-action" style="width: 100%; padding: 15px;">Weekly Summary</button>
                    <button class="btn-action" style="width: 100%; padding: 15px;">Monthly Analytics</button>
                    <button class="btn-action" style="width: 100%; padding: 15px;">Export to Excel</button>
                    <button class="btn-action" style="width: 100%; padding: 15px;">Export to PDF</button>
                    <button class="btn-action" style="width: 100%; padding: 15px;">Email Reports</button>
                </div>
            </div>
        </div>
    </div>

    <!-- Device Details Modal -->
    <div id="deviceModal" class="modal">
        <div class="modal-content">
            <div class="modal-header">
                <h2 id="modalTitle">Device Details</h2>
                <span class="close-modal" onclick="closeDeviceModal()">&times;</span>
            </div>
            <div class="modal-body" id="modalBody">
                <!-- Report Type Selector -->
                <div style="margin-bottom: 15px;">
                    <div style="display: flex; gap: 10px; align-items: center; flex-wrap: wrap; margin-bottom: 10px;">
                        <span style="color: #8b9dc3; font-weight: 600;">View Report:</span>
                        <button class="report-tab-btn active" id="allReportBtn" onclick="switchReportView('all')">All Devices</button>
                        <button class="report-tab-btn" id="onlineReportBtn" onclick="switchReportView('online')">Devices Online</button>
                        <button class="report-tab-btn" id="offlineReportBtn" onclick="switchReportView('offline')">Devices Offline</button>
                    </div>
                    <div style="display: flex; gap: 10px; flex-wrap: wrap;">
                        <button class="btn-download" onclick="downloadCurrentReport()" style="background: linear-gradient(135deg, #00d4ff 0%, #00a8cc 100%); color: #0a0e27; font-weight: 600;">Download PDF</button>
                        <button class="btn-download" onclick="showDeviceReportDateRangeFromModal()" style="background: linear-gradient(135deg, #00d4ff 0%, #00a8cc 100%); color: #0a0e27; font-weight: 600;">Download Custom Report</button>
                    </div>
                </div>
                
                <!-- Device Count Summary -->
                <div id="reportSummary" style="margin-bottom: 15px; padding: 10px; background: rgba(0, 212, 255, 0.1); border-radius: 8px; color: #00d4ff; font-size: 0.9rem;">
                </div>
                
                <div class="table-container" style="max-height: 450px; overflow-y: auto; overflow-x: hidden;">
                    <table id="deviceDetailsTable">
                        <thead style="position: sticky; top: 0; z-index: 10; background: rgba(0, 212, 255, 0.2);">
                            <tr>
                                <th>Sr. No.</th>
                                <th>Device Type</th>
                                <th>Gate</th>
                                <th>Count</th>
                                <th>Status</th>
                            </tr>
                        </thead>
                        <tbody id="deviceDetailsBody">
                        </tbody>
                    </table>
                </div>
            </div>
        </div>
    </div>

    <!-- Gate Pie Chart Modal -->
    <div id="gatePieModal" class="modal">
        <div class="modal-content" style="max-width: 800px;">
            <div class="modal-header">
                <h2 id="gatePieModalTitle">Gate Device Distribution</h2>
                <span class="close-modal" onclick="closeGatePieModal()">&times;</span>
            </div>
            <div class="modal-body">
                <div style="display: flex; justify-content: space-between; align-items: center; margin-bottom: 1rem;">
                    <div>
                        <p style="color: #8b9dc3; font-size: 0.9rem; margin: 0;">Device distribution breakdown for selected gate</p>
                    </div>
                    <button onclick="showGateReportDateRange()" style="background: linear-gradient(135deg, #667eea 0%, #764ba2 100%); color: white; border: none; padding: 0.6rem 1rem; border-radius: 8px; cursor: pointer; font-size: 0.85rem; font-weight: 600;">
                        Download Custom Report
                    </button>
                </div>
                <canvas id="gateDevicePieChart" style="max-height: 400px;"></canvas>
            </div>
        </div>
    </div>


    <script src="script.js"></script>
    
    <script>
    // Ensure vehicle monitoring functions are available
    window.addEventListener('DOMContentLoaded', function() {
        console.log('Page loaded, checking functions...');
        console.log('showExpiredBadgeAttempts:', typeof showExpiredBadgeAttempts);
        console.log('showSpeedViolations:', typeof showSpeedViolations);
        console.log('showTankerMovement:', typeof showTankerMovement);
        console.log('showRepeatOffenders:', typeof showRepeatOffenders);
        
        // If functions don't exist, define them here
        if (typeof showExpiredBadgeAttempts === 'undefined') {
            console.error('Functions not loaded from script.js, defining inline...');
            
            window.showExpiredBadgeAttempts = function() {
                alert('showExpiredBadgeAttempts called');
                const modal = document.getElementById('deviceModal');
                const modalTitle = document.getElementById('modalTitle');
                const modalBody = document.getElementById('modalBody');
                
                modalTitle.textContent = 'Expired Badge Access Attempts - Today';
                modalBody.innerHTML = `
                    <div style="max-height: 500px; overflow-y: auto;">
                        <p style="color: #8b9dc3; margin-bottom: 15px;">Personnel who attempted access with expired badges</p>
                        <table class="data-table">
                            <thead>
                                <tr>
                                    <th>Time</th>
                                    <th>Name</th>
                                    <th>Badge ID</th>
                                    <th>Gate</th>
                                    <th>Expired Since</th>
                                </tr>
                            </thead>
                            <tbody>
                                <tr>
                                    <td>14:35</td>
                                    <td style="color: #ff3366; font-weight: 600;">Ramesh Kumar</td>
                                    <td>EMP-2847</td>
                                    <td>Main Gate</td>
                                    <td style="color: #ff3366;">3 days</td>
                                </tr>
                                <tr>
                                    <td>13:20</td>
                                    <td style="color: #ff3366; font-weight: 600;">Priya Sharma</td>
                                    <td>CON-5621</td>
                                    <td>LP Gate</td>
                                    <td style="color: #ff3366;">1 day</td>
                                </tr>
                                <tr>
                                    <td>11:45</td>
                                    <td style="color: #ff3366; font-weight: 600;">Vijay Patel</td>
                                    <td>VIS-8934</td>
                                    <td>Cargo Gate</td>
                                    <td style="color: #ff3366;">7 days</td>
                                </tr>
                                <tr>
                                    <td>10:30</td>
                                    <td style="color: #ff3366; font-weight: 600;">Sunita Reddy</td>
                                    <td>CON-4512</td>
                                    <td>Jokatte Gate</td>
                                    <td style="color: #ff3366;">2 days</td>
                                </tr>
                                <tr>
                                    <td>09:15</td>
                                    <td style="color: #ff3366; font-weight: 600;">Anil Mehta</td>
                                    <td>EMP-3298</td>
                                    <td>E2 Gate</td>
                                    <td style="color: #ff3366;">5 days</td>
                                </tr>
                                <tr>
                                    <td>08:50</td>
                                    <td style="color: #ff3366; font-weight: 600;">Kavita Desai</td>
                                    <td>VIS-7621</td>
                                    <td>Main Gate</td>
                                    <td style="color: #ff3366;">1 day</td>
                                </tr>
                            </tbody>
                        </table>
                        <div style="margin-top: 15px; padding: 10px; background: rgba(255, 51, 102, 0.1); border-radius: 8px; color: #ff3366;">
                            <strong>Total Expired Badge Attempts:</strong> 6 today
                        </div>
                    </div>
                `;
                modal.style.display = 'block';
            };
        }
    });
    </script>
</body>
</html>

